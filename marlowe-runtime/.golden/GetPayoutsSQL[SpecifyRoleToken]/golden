Total count statement: WITH roleTokens (rolesCurrency, role) AS (SELECT * FROM UNNEST($1, $2)) SELECT count(*) FROM marlowe.payoutTxOut NATURAL JOIN marlowe.applyTx NATURAL JOIN roleTokens WHERE TRUE
Payouts statement: WITH roleTokens (rolesCurrency, role) AS (SELECT * FROM UNNEST($1, $2)) SELECT withdrawalTxIn.txId, applyTx.createTxId, applyTx.createTxIx, payoutTxOut.txId, payoutTxOut.txIx, payoutTxOut.rolesCurrency, payoutTxOut.role FROM marlowe.payoutTxOut NATURAL JOIN marlowe.applyTx NATURAL JOIN roleTokens LEFT JOIN marlowe.withdrawalTxIn ON payoutTxOut.txId = withdrawalTxIn.payoutTxId AND payoutTxOut.txIx = withdrawalTxIn.payoutTxIx ORDER BY applyTx.slotNo DESC, payoutTxOut.txId DESC, payoutTxOut.txIx DESC OFFSET $3 FETCH NEXT $4 ROWS ONLY
